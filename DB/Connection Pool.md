# 📌 데이터베이스 커넥션 풀 (Connection Pool) 사용의 필요성

## 1. 커넥션의 생명주기

애플리케이션이 DB에 접근할 때, 다음과 같은 과정을 거침:

1. 데이터베이스 드라이버를 통해 연결 생성
2. TCP 소켓을 열고 세션 연결
3. 데이터 읽기/쓰기
4. 연결 종료
5. 소켓 및 자원 해제

---

## 2. 커넥션 풀 미사용 시 발생하는 문제

| 항목 | 문제점 |
|------|--------|
| ❌ 매 요청마다 커넥션 생성 | 커넥션 생성/해제는 무거운 I/O 작업이며, 요청 처리 지연 발생 |
| ❌ 커넥션 재사용 없음 | GC 부담 증가, 리소스 낭비 |
| ❌ 동시 요청 처리 불가 | DB 최대 연결 수 초과 → `Too many connections` 에러 발생 |
| ❌ 응답 속도 저하 | TPS 감소, 전체 시스템의 지연 확대 |
| ❌ 예측 불가한 부하 상황 | DB 자원 초과로 장애 전파 가능성 있음 |

---

## 3. 커넥션 풀의 이점

| 항목 | 설명 |
|------|------|
| ✅ 커넥션 재사용 | 연결 생성 비용 절감, 빠른 응답 |
| ✅ 자원 최적화 | DB, CPU, 메모리 사용 효율화 |
| ✅ 연결 수 제한 가능 | 무분별한 커넥션 생성 방지, 안정성 확보 |
| ✅ 커넥션 대기 관리 | 필요시 대기 큐를 활용하여 요청 흐름 제어 |
| ✅ 설정 유연성 | 초기/최대 풀 사이즈, 타임아웃 등 전략적 구성 가능 |

---

## 4. 커넥션 풀 사이즈는 클수록 좋은가? 🤔

- **NO.** 단순히 크다고 좋은 것이 아님.
- 커넥션은 **스레드(Thread)** 와 밀접하게 연결됨

| 상황 | 결과 |
|------|------|
| 커넥션 수 > 스레드 수 | 일부 커넥션은 사용되지 않고 낭비됨 |
| 커넥션 수 < 스레드 수 | 스레드가 커넥션 반환을 기다리며 대기 → 성능 저하 |
| 너무 큰 커넥션 풀 | DB 및 애플리케이션 서버에 과도한 부하 초래 |

---

## 5. 적절한 커넥션 풀 사이즈는?

> 시스템에 따라 조정 필요. 다음은 참고용 공식
최적 커넥션 수 ≈ TPS * 평균 응답 시간 / 동시 처리 수
