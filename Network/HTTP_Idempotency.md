# HTTP 메서드의 멱등성 (Idempotency)

## ✅ 정의

멱등성(Idempotency)이란 **같은 연산을 여러 번 적용해도 결과가 동일한 성질**을 의미한다.  
HTTP에서 멱등성이란, **같은 요청을 여러 번 보내도 서버 상태에 변화가 없거나 동일한 결과를 보장하는 것**이다.

---

## 💡 멱등한 HTTP 메서드

| HTTP 메서드 | 멱등성 | 설명 |
|-------------|--------|------|
| GET         | ✅     | 리소스 조회 요청. 호출 수와 관계없이 상태 변화 없음 |
| HEAD        | ✅     | GET과 유사하지만 본문 없이 헤더만 반환 |
| PUT         | ✅     | 지정된 리소스를 덮어쓰기. 여러 번 호출해도 결과 동일 |
| DELETE      | ✅     | 리소스 삭제 요청. 이미 삭제된 상태에서 다시 삭제해도 동일 |
| OPTIONS     | ✅     | 요청 가능한 메서드에 대한 정보를 조회 |
| TRACE       | ✅     | 클라이언트와 서버 간의 요청 경로를 추적 (디버깅 목적) |

---

## ⚠️ 멱등하지 않은 HTTP 메서드

| HTTP 메서드 | 멱등성 | 설명 |
|-------------|--------|------|
| POST        | ❌     | 새로운 리소스 생성 또는 작업 수행. 매 요청마다 서버 상태 변화 가능 |
| PATCH       | ❌     | 리소스의 일부만 수정. 반복 시 결과가 달라질 수 있음 |

---

## 🛠 멱등성이 중요한 이유

- 네트워크 장애나 서버 오류로 인해 클라이언트가 **요청을 재시도할 수밖에 없는 상황**이 발생할 수 있음
- 이때 요청이 멱등하면 **중복 요청으로 인한 부작용 없이 재요청 가능**
- 멱등하지 않은 경우 **중복 실행에 따른 부작용(예: 중복 결제, 중복 등록)** 발생 위험

---

## 🔐 멱등성 활용 사례: 결제 API

### 📍 문제 상황

1. 사용자가 결제 요청을 보냄  
2. 서버에서는 실제 결제 수행  
3. 클라이언트는 네트워크 오류로 응답을 받지 못함  
4. 같은 결제 요청을 다시 보냄  

### 📍 멱등성 없는 API
- 서버는 **또 결제**를 수행함 → **중복 결제 발생**

### 📍 멱등성 있는 API
- 클라이언트는 `Idempotency-Key`를 함께 보냄
- 서버는 같은 키로 이미 처리된 요청을 인식하고 **같은 응답을 반환**함

```http
POST /payments
Idempotency-Key: abc-123
```

---

## 🧩 멱등 키(Idempotency-Key) 구현 방식

- 클라이언트에서 요청 시 고유 키를 생성하여 `Header`에 포함
- 서버는 해당 키와 요청 내용을 **캐싱 또는 로그로 저장**
- 동일 키의 요청이 오면 **처리하지 않고 이전 응답 재사용**

---

## 📌 멱등성과 시스템 설계의 연결

- **API의 예측 가능성** 향상
- **장애 복구, 재시도 처리**에서 신뢰성 보장
- **분산 시스템, 메시지 큐, 중복 제거 처리**에서도 핵심 개념

---

## ✅ 결론

- 멱등성은 단순한 HTTP 속성이 아니라, **안정적인 API와 서비스 설계의 핵심 철학**
- POST라도 멱등하게 설계할 수 있으며, 멱등성을 어디서 보장할지는 **아키텍처 설계의 몫**
