# TCP 3-Way Handshake 정리

## 📌 개요
TCP(Transmission Control Protocol)는 신뢰성 있는 데이터 전송을 위해 통신 시작 시 **3-Way Handshake**라는 연결 설정 절차를 거친다.  
이 과정을 통해 양쪽 모두 연결 의사를 확인하고, 순서 번호를 동기화하여 데이터 송수신 준비를 한다.

---

## 🔁 3-Way Handshake 동작 과정

1. **SYN (Synchronize) - 클라이언트 → 서버**
   - 클라이언트가 서버에 연결 요청
   - TCP 헤더의 SYN 플래그를 `1`로 설정
   - 클라이언트의 초기 순서 번호 (ISN: Initial Sequence Number) 포함
   - 💬 예시: "연결하고 싶어, 내 시퀀스 넘버는 100이야."

2. **SYN-ACK - 서버 → 클라이언트**
   - 서버가 클라이언트의 요청 수락
   - SYN 플래그와 ACK 플래그를 모두 `1`로 설정
   - 자신의 ISN과 함께 클라이언트의 ISN+1을 ACK로 전송
   - 💬 예시: "좋아, 연결하자. 내 번호는 250이고, 네 번호는 100 잘 받았어."

3. **ACK - 클라이언트 → 서버**
   - 클라이언트가 서버의 응답을 확인하고 최종 ACK 전송
   - ACK 번호 = 서버의 ISN + 1
   - 💬 예시: "네 번호 250 확인했어, 이제 데이터 주고받자!"

---

## 📐 왜 3번이나 주고받을까? (기준 형성)

- **신뢰성 확보**: 송신/수신 모두 연결 의사를 갖고 있는지 확인
- **시퀀스 번호 동기화**: TCP는 순서 보장이 중요한 프로토콜
- **쌍방 확인**: 단방향이 아닌 양방향 연결 보장이 필요

---

## ⚠️ 보안 및 구조적 리스크

- **SYN Flood 공격**
  - 클라이언트가 ACK 없이 SYN만 보내고 끊어버리면?
  - 서버는 연결 대기 상태(Half-Open)로 리소스를 낭비하게 됨

---

## 🔭 시야 확장 포인트

- **TCP 연결 종료는 왜 4번(4-way handshake)일까?**
- **UDP는 Handshake가 없는데, 언제 사용하는 게 적절할까?**
- **TLS Handshake는 TCP Handshake 이후에 왜 추가로 필요한가?**
- **커널에서 SYN queue와 accept queue는 어떻게 다를까?**

---

## 📊 요약

| 단계 | 송신자    | 플래그      | 설명                                  |
|------|-----------|-------------|---------------------------------------|
| 1    | 클라이언트 | SYN         | 연결 요청 및 시퀀스 넘버 전달         |
| 2    | 서버       | SYN + ACK   | 요청 수락, 서버 ISN 전달, 클라이언트 ISN 확인 |
| 3    | 클라이언트 | ACK         | 서버 ISN 확인 후 최종 응답           |

---

